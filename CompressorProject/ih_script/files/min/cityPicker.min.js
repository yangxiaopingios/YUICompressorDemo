var IIInsomniaCityPicker=function(a){this.template=$('<div class="IIInsomnia-city-picker" id="IIInsomnia_city_picker"><div class="IIInsomnia-hot-wrap"><ul id="IIInsomnia_hot_city"></ul></div><div class="line"></div><div class="IIInsomnia-wrap"><p>选择省份</p><ul class="IIInsomnia-province-wrap" id="IIInsomnia_province_wrap"></ul></div></div>');
this.hot_city=$("#IIInsomnia_hot_city",this.template);this.province_wrap=$("#IIInsomnia_province_wrap",this.template);
this.settings={data:a.data,target:$(a.target),valType:a.valType||"k",multiple:a.multiple||false,hideProvinceInput:a.hideProvinceInput?$(a.hideProvinceInput):false,hideCityInput:a.hideCityInput?$(a.hideCityInput):false,callback:a.callback||""}
};IIInsomniaCityPicker.prototype={init:function(){var a=this;$(window).click(function(b){a.template.remove()
});a.settings.target.attr("readonly",true);a.targetEvent()},buildCityPicker:function(){var a=this;
a.buildHotCityTpl();a.buildProvinceTpl();a.provinceEvent();a.cityEvent();a.cleanBtnEvent()
},buildHotCityTpl:function(){var d=this;var b=d.settings.data.hot;var e="";for(var c=0,a=b.length;
c<a;c++){e+='<li class="IIInsomnia-hot-city" data-id="'+b[c]["id"]+'" data-name="'+b[c]["name"]+'" data-pid="'+b[c]["pid"]+'" data-pname="'+b[c]["pname"]+'">'+b[c]["name"]+"</li>"
}d.hot_city.html(e)},buildProvinceTpl:function(){var d=this;var b=d.settings.data.province;
var e="";for(var c=0,a=b.length;c<a;c++){e+='<li class="IIInsomnia-province" data-id="'+b[c]["id"]+'" data-name="'+b[c]["name"]+'"><ul class="IIInsomnia-city-wrap"></ul><div class="IIInsomnia-province-name">'+b[c]["name"]+"</div></li>"
}d.province_wrap.html(e)},buildCityTpl:function(d){var l=this;var k=d.data("id");
var a=d.position();var b=l.settings.data.province;var g;var c="";for(var h=0,e=b.length;
h<e;h++){if(b[h]["id"]==parseInt(k)){g=b[h]["city"];break}}for(var f=0,m=g.length;
f<m;f++){c+='<li class="IIInsomnia-city" data-id="'+g[f]["id"]+'" data-name="'+g[f]["name"]+'" title="'+g[f]["name"]+'">'+g[f]["name"]+"</li>"
}d.find(".IIInsomnia-city-wrap").html(c).css("left","-"+(a.left-9)+"px").show()},provinceEvent:function(){var a=this;
a.province_wrap.on("click",".IIInsomnia-province",function(b){b.preventDefault();
b.stopPropagation();var c=$(this);if(!c.hasClass("active")){a.province_wrap.find(".IIInsomnia-province").removeClass("active");
a.province_wrap.find(".IIInsomnia-province-name").removeClass("active");a.province_wrap.find(".IIInsomnia-city-wrap").hide().children().remove();
c.addClass("active");c.find(".IIInsomnia-province-name").addClass("active");a.buildCityTpl(c)
}else{c.removeClass("active");c.find(".IIInsomnia-province-name").removeClass("active");
c.find(".IIInsomnia-city-wrap").hide().children().remove()}return false})},cityEvent:function(){var a=this;
a.hot_city.on("click",".IIInsomnia-hot-city",function(e){e.preventDefault();e.stopPropagation();
var g=$(this);var f=g.data("id");var c=g.data("name");a.settings.target.val(c);if(a.settings.hideCityInput){if(a.settings.valType=="k-v"){a.settings.hideCityInput.val(f+"-"+c)
}else{a.settings.hideCityInput.val(f)}}if(a.settings.hideProvinceInput){var b=g.data("pid");
var d=g.data("pname");if(a.settings.valType=="k-v"){a.settings.hideProvinceInput.val(b+"-"+d)
}else{a.settings.hideProvinceInput.val(b)}}a.template.remove();if(a.settings.callback){a.settings.callback(f)
}return false});a.province_wrap.on("click",".IIInsomnia-city",function(f){f.preventDefault();
f.stopPropagation();var h=$(this);var g=h.data("id");var d=h.data("name");a.settings.target.val(d);
if(a.settings.hideCityInput){if(a.settings.valType=="k-v"){a.settings.hideCityInput.val(g+"-"+d)
}else{a.settings.hideCityInput.val(g)}}if(a.settings.hideProvinceInput){var b=h.parent().parent();
var c=b.data("id");var e=b.data("name");if(a.settings.valType=="k-v"){a.settings.hideProvinceInput.val(c+"-"+e)
}else{a.settings.hideProvinceInput.val(c)}}a.template.remove();if(a.settings.callback){a.settings.callback(g)
}return false})},cleanBtnEvent:function(){var a=this;a.province_wrap.on("click","#IIInsomnia_clean_btn",function(b){b.preventDefault();
b.stopPropagation();a.settings.target.val("");if(a.settings.hideProvinceInput){a.settings.hideProvinceInput.val("")
}if(a.settings.hideCityInput){a.settings.hideCityInput.val("")}a.template.remove();
if(a.settings.callback){a.settings.callback(0)}return false})},targetEvent:function(){var a=this;
a.settings.target.click(function(b){b.stopPropagation();var e=$(this);a.buildCityPicker();
var d=e.offset();var c=d.top+e.outerHeight()+15;a.template.css({left:d.left,top:c});
$("body").append(a.template);return false})}};