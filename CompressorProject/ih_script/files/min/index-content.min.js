$(function(){function b(){var i=new Date();i.setTime(i.getTime()-24*60*60*1000);return i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate()
}var d=b();var e=0;var g=d;var h=true;var a=-1;var f=-1;$(".dateChoice").attr("placeholder",d);
$(".export_excel").click(function(){$.ajax({type:"post",cache:false,data:{countDate:g,cityCode:e,dayNumOrder:a,countNumOrder:f},url:ih.domain+"/store/exportExcel",dataType:"json",success:function(i){if(i.code==="1"){window.location.href=i.url
}else{jError("测量总次数请求code有错误",{HorizontalPosition:"center",VerticalPosition:"center"})
}},error:function(i){jError("请求有错误",{HorizontalPosition:"center",VerticalPosition:"center"});
console.log("err10: ");console.log(i)}})});$.ajax({type:"post",cache:false,data:{},url:ih.domain+"/measure/count",dataType:"json",success:function(i){if(i.code==="1"){$(".ih_count").html(i.msg.count);
$(".ih_scanCount").html(i.msg.scanCount)}else{jError("测量总次数请求code有错误",{HorizontalPosition:"center",VerticalPosition:"center"})
}},error:function(i){jError("请求有错误",{HorizontalPosition:"center",VerticalPosition:"center"});
console.log("err1: ");console.log(i)}});function c(j,i){$.ajax({type:"post",cache:false,data:{cityCode:j,countDate:i},url:ih.domain+"/store/downlist",dataType:"json",success:function(k){if(k.code==="1"){if(h){h=false;
$.jgrid.defaults.styleUI="Bootstrap";$("#table_list_1").jqGrid({data:k.msg,datatype:"local",height:350,autowidth:true,shrinkToFit:true,rowNum:25,rowList:[25,50,75],colNames:["门店名称","门店联系方式","当日测量次数","累计测量次数","操作"],colModel:[{name:"name",index:"name",width:150,align:"center",sortable:false},{name:"phone",index:"phone",width:90,align:"center",sortable:false},{name:"days_num",index:"days_num",width:60,align:"center",sorttype:"int"},{name:"count_num",index:"count_num",width:60,align:"center",sorttype:"int"},{name:"sid",index:"sid",width:80,align:"center",sortable:false,formatter:function(m,o,n){return"<a href='shop-info.html?sid="+m+"'>查看详情</a>"
}}],pager:"#pager_list_1",viewrecords:true,hidegrid:false,onSortCol:function(o,n,m){if(o==="days_num"){f=-1;
if(m==="asc"){a=1}else{if(m==="desc"){a=0}}}else{if(o==="count_num"){a=-1;if(m==="asc"){f=1
}else{if(m==="desc"){f=0}}}}}});$(window).bind("resize",function(){var m=$(".jqGrid_wrapper").width();
$("#table_list_1").setGridWidth(m);$("#table_list_1").setGridHeight($(window).height()-355)
})}else{$("#table_list_1").jqGrid("clearGridData");$("#table_list_1").jqGrid("setGridParam",{data:k.msg}).trigger("reloadGrid")
}var l=$(".jqGrid_wrapper").width();$("#table_list_1").setGridWidth(l);$("#table_list_1").setGridHeight($(window).height()-355);
$("span.s-ico",document.getElementById("table_list_1_count_num")).show();$("span.s-ico",document.getElementById("table_list_1_days_num")).show()
}else{jError("店面列表信息下载请求code有错误",{HorizontalPosition:"center",VerticalPosition:"center"})
}},error:function(k){jError("请求有错误",{HorizontalPosition:"center",VerticalPosition:"center"});
console.log("err3: ");console.log(k)}})}c(e,g);$(".dateChoice").click(function(){laydate({istime:false,format:"YYYY-MM-DD",max:d,start:d,isclear:false,istoday:false,choose:function(i){g=i;
c(e,g)}})});$.ajax({type:"post",cache:false,data:{},url:ih.domain+"/basicdata/city",dataType:"json",success:function(k){var n=[];
for(var l=0;l<k.msg.length;l++){switch(k.msg[l].name){case"北京市":case"天津市":case"重庆市":case"上海市":console.log(k.msg[l].name);
k.msg[l].city.push({id:k.msg[l].id,name:k.msg[l].name});n.push(k.msg[l]);break;default:if(k.msg[l].city.length!==0){n.push(k.msg[l])
}}}if(k.code==="1"){var m={hot:[{pid:100,pname:"全部省份",id:0,name:"全部"}],province:n};
var j=new IIInsomniaCityPicker({data:m,target:"#cityChoice",valType:"k-v",hideCityInput:"#city",hideProvinceInput:"#province",callback:function(i){e=i;
c(e,g)}});j.init()}else{jError("省市字典信息下载请求code有错误",{HorizontalPosition:"center",VerticalPosition:"center"})
}},error:function(i){jError("请求有错误",{HorizontalPosition:"center",VerticalPosition:"center"});
console.log("err2: ");console.log(i)}})});